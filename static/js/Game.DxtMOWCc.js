import{d as ae,l as d,k as A,s as oe,A as ne,c as u,L as E,a as o,J as t,u as re,K as ie,r as I,F as N,M as z,E as g,N as w,w as C,O as H,b as F,o as i}from"./vue.BvTOQNwI.js";import{u as ce}from"./game.CxZyzCUV.js";import{u as ue,P as ve}from"./ProgressBar.Smnf-aHg.js";import{W as de,p as L,s as J,a as me}from"./WordCard.DkxCWTVQ.js";import{a as M}from"./index.uiberFsp.js";import{s as fe}from"./function-call.xAP56dwZ.js";import{s as T}from"./function-call.Dc0_85iV.js";import{_ as _e}from"./_plugin-vue_export-helper.DlAUqK2U.js";const pe={class:"game-container"},he={key:0,class:"levels-container"},ke={class:"level-intro"},ge={class:"level-intro-icon"},we={class:"levels-grid"},ye=["onClick"],Ce={class:"level-number"},Le={class:"level-stars"},xe={key:1,class:"level-complete-badge"},be={key:1,class:"gameplay-container"},Se={class:"game-info"},We={class:"game-timer"},Ee={class:"word-challenge"},Ne={class:"answer-options"},ze={class:"game-actions"},Me={key:2,class:"result-container"},Te={class:"result-content"},Be={class:"result-stats"},$e={class:"stat-item"},qe={class:"stat-value"},Ae={class:"stat-item"},Ie={class:"stat-value"},Fe={class:"stat-item"},Re={class:"stars-container"},Ve={class:"result-actions"},De=ae({__name:"Game",setup(Ge){const K=ie(),x=ce(),m=ue(),f=d("levels"),a=d(null),c=d(null),y=d([]),_=d(0),p=d(0),h=d(null),b=d(!1),k=d(0),B=A(()=>x.levels),W=A(()=>{var s;return _.value>=(((s=a.value)==null?void 0:s.wordsRequired)||0)}),R=A(()=>{if(!a.value)return!1;const s=a.value.id+1;return B.value.some(e=>e.id===s)});oe(()=>{x.initLevels(),m.initWords()}),ne(()=>{h.value&&clearInterval(h.value)});const j=s=>{if(!s.isUnlocked){T("这个关卡还没有解锁哦！"),L("wrong"),document.querySelectorAll(".level-item.level-locked").forEach(n=>{M(n,"shake",500)});return}L("click"),a.value=s,x.setCurrentLevel(s.id),$(),J({type:"primary",message:`第${s.id}关开始啦！加油！`,duration:2e3})},$=()=>{a.value&&(_.value=0,p.value=a.value.timeLimit,b.value=!1,q(),Z(),f.value="playing")},q=()=>{const s=m.words.filter(e=>!m.masteredWords.includes(e.id));s.length===0?c.value=m.words[Math.floor(Math.random()*m.words.length)]:c.value=s[Math.floor(Math.random()*s.length)],Q()},Q=()=>{if(!c.value)return;y.value=[],y.value.push(c.value);const e=[...m.words.filter(n=>{var r;return n.id!==((r=c.value)==null?void 0:r.id)})].sort(()=>.5-Math.random());y.value.push(...e.slice(0,3)),y.value=y.value.sort(()=>.5-Math.random())},X=s=>{if(!c.value||!a.value)return;if(s.id===c.value.id){_.value++,T({message:"回答正确！",icon:"success",className:"custom-toast"}),L("correct"),me(c.value.english);const n=document.querySelector(".word-card");if(n&&M(n,"tada",800),m.learnWord(c.value.id),_.value>=a.value.wordsRequired){V(!0);return}}else T({message:"再试一次！",icon:"cross",className:"custom-toast"}),L("wrong"),document.querySelectorAll(".answer-option").forEach(r=>{var v;((v=r.textContent)==null?void 0:v.trim())===s.chinese&&M(r,"shake",500)});q()},Y=()=>{q(),T({message:"已跳过",position:"bottom"})},Z=()=>{h.value&&clearInterval(h.value),h.value=setInterval(()=>{p.value>0?p.value--:V(!1)},1e3)},V=s=>{h.value&&clearInterval(h.value),a.value&&(ee(s),s?(x.completeLevel(a.value.id,k.value,_.value*10+p.value),L("levelComplete"),J({type:"success",message:"太棒了！你完成了这个关卡！",duration:3e3})):L("wrong"),f.value="result",setTimeout(()=>{const e=document.querySelector(".result-content");e&&M(e,"bounce",1e3)},100))},ee=s=>{if(!s||!a.value){k.value=0;return}const e=p.value/a.value.timeLimit;e>.7?k.value=3:e>.4?k.value=2:k.value=1},se=()=>{$()},te=()=>{if(!a.value||!R.value)return;const s=B.value.find(e=>e.id===a.value.id+1);s&&(a.value=s,x.setCurrentLevel(s.id),$())},D=()=>{f.value="levels"},le=()=>{fe({title:"确认退出",message:"游戏进度将不会保存，确定要退出吗？",confirmButtonText:"确认",cancelButtonText:"取消"}).then(()=>{f.value="levels"}).catch(()=>{})},G=s=>{const e=Math.floor(s/60),n=s%60;return`${e.toString().padStart(2,"0")}:${n.toString().padStart(2,"0")}`};return(s,e)=>{var U,P,O;const n=I("van-nav-bar"),r=I("van-icon"),v=I("van-button");return i(),u("div",pe,[f.value==="levels"?(i(),u("div",he,[o(n,{title:"选择关卡","left-text":"返回","left-arrow":"",onClickLeft:e[0]||(e[0]=l=>re(K).push("/"))}),t("div",ke,[t("div",ge,[o(r,{name:"smile-o",size:"24",color:"#4caf50"})]),e[2]||(e[2]=t("div",{class:"level-intro-text"}," 选择一个关卡开始挑战吧！每完成一关都会获得星星奖励哦！ ",-1))]),t("div",we,[(i(!0),u(N,null,z(B.value,l=>(i(),u("div",{key:l.id,class:H(["level-item",{"level-locked":!l.isUnlocked,"level-completed":l.isCompleted}]),onClick:S=>j(l)},[t("div",Ce,w(l.id),1),t("div",Le,[(i(),u(N,null,z(3,S=>o(r,{key:S,name:S<=l.stars?"star":"star-o",color:S<=l.stars?"#FFD700":"#ccc",class:"star-icon"},null,8,["name","color"])),64))]),l.isUnlocked?E("",!0):(i(),F(r,{key:0,name:"lock",class:"level-lock-icon"})),l.isCompleted?(i(),u("div",xe,[o(r,{name:"success"})])):E("",!0)],10,ye))),128))])])):f.value==="playing"?(i(),u("div",be,[o(n,{title:`第${(U=a.value)==null?void 0:U.id}关`,"left-text":"退出","left-arrow":"",onClickLeft:le},null,8,["title"]),t("div",Se,[t("div",We,[o(r,{name:"clock-o"}),g(" "+w(G(p.value)),1)]),o(ve,{"current-value":_.value,"max-value":((P=a.value)==null?void 0:P.wordsRequired)||5,label:"进度","show-percentage":""},null,8,["current-value","max-value"])]),t("div",Ee,[o(de,{word:c.value,"show-chinese":b.value,"show-actions":!1},null,8,["word","show-chinese"]),t("div",Ne,[(i(!0),u(N,null,z(y.value,l=>(i(),F(v,{key:l.id,size:"large",block:"",class:"answer-option",onClick:S=>X(l)},{default:C(()=>[g(w(l.chinese),1)]),_:2},1032,["onClick"]))),128))]),t("div",ze,[o(v,{type:"primary",plain:"",size:"small",onClick:e[1]||(e[1]=l=>b.value=!b.value)},{default:C(()=>[g(w(b.value?"隐藏提示":"显示提示"),1)]),_:1}),o(v,{type:"warning",plain:"",size:"small",onClick:Y},{default:C(()=>e[3]||(e[3]=[g(" 跳过 ")])),_:1,__:[3]})])])])):f.value==="result"?(i(),u("div",Me,[o(n,{title:"关卡结果","left-text":"返回","left-arrow":"",onClickLeft:D}),t("div",Te,[t("div",{class:H(["result-header",W.value?"success":"failed"])},[o(r,{name:W.value?"success":"cross",size:"48"},null,8,["name"]),t("h2",null,w(W.value?"恭喜通关！":"再接再厉！"),1)],2),t("div",Be,[t("div",$e,[e[4]||(e[4]=t("span",{class:"stat-label"},"正确单词",-1)),t("span",qe,w(_.value),1)]),t("div",Ae,[e[5]||(e[5]=t("span",{class:"stat-label"},"用时",-1)),t("span",Ie,w(G(((O=a.value)==null?void 0:O.timeLimit)-p.value)),1)]),t("div",Fe,[e[6]||(e[6]=t("span",{class:"stat-label"},"获得星星",-1)),t("div",Re,[(i(),u(N,null,z(3,l=>o(r,{key:l,name:l<=k.value?"star":"star-o",color:l<=k.value?"#FFD700":"#ccc",size:"24"},null,8,["name","color"])),64))])])]),t("div",Ve,[o(v,{type:"primary",block:"",round:"",size:"large",onClick:se},{default:C(()=>e[7]||(e[7]=[g(" 再玩一次 ")])),_:1,__:[7]}),W.value&&R.value?(i(),F(v,{key:0,type:"success",block:"",round:"",size:"large",onClick:te},{default:C(()=>e[8]||(e[8]=[g(" 下一关 ")])),_:1,__:[8]})):E("",!0),o(v,{type:"default",block:"",round:"",size:"large",onClick:D},{default:C(()=>e[9]||(e[9]=[g(" 返回关卡 ")])),_:1,__:[9]})])])])):E("",!0)])}}}),Xe=_e(De,[["__scopeId","data-v-cfff340e"]]);export{Xe as default};
